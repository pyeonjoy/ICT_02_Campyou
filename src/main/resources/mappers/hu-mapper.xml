<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

	<!-- Create Account & Login & find ID and Pwd -->
	<insert id="insert" parameterType="mvo">
		insert into members(member_id, member_name, member_pwd, member_nickname, member_dob, member_phone, member_email, member_regdate)
			values(#{member_id}, #{member_name},#{member_pwd},#{member_nickname},#{member_dob}, #{member_phone},#{member_email}, sysdate())
	</insert>
	
	<select id="idchk" parameterType="String" resultType="int">
 		select count(*) from members where member_id=#{member_id}
 	</select>
 	
 	<select id="loginIdchk" parameterType="String" resultType="int">
 		select count(*) from members where member_id=#{member_id}
 	</select>
 	
 	<select id="login" parameterType="mvo" resultType="mvo">
 		select * from members where member_id=#{member_id}
 	</select>
 	
 	<select id="findPwd" parameterType="mvo" resultType="mvo">
		select * from members where member_id=#{member_id}
	</select>
	
	<update id="tempPwdUpdate" parameterType="mvo">
         update members
         set member_pwd=#{member_pwd}
         where member_id = #{member_id}
    </update>
    
    <select id="findId" parameterType="String" resultType="mvo">
		select * from members where member_name=#{member_name}
	</select>
	
	<select id="nickNameChk" parameterType="String" resultType="int">
 		select count(*) from members where member_nickname=#{member_nickname}
 	</select>
 	
 	<!-- Community Board -->
 	<select id="count" resultType="int">
 		select count(*) from board_free
 	</select>
 	
 	<!-- commBoard  -->
 	<!-- <select id="comm_board_list" parameterType="Map" resultType="cbvo">
 		select * from board_free order by groups member_grade  limit #{limit} offset #{offset}
		select * from board_free order by groups desc, lev asc  limit #{limit} offset #{offset} 
 	</select> -->
 	
 	<select id="comm_board_list" parameterType="Map" resultType="cbvo">
	    select * from board_free 
	    where b_type = '공지사항'
	    union 
	    select * from board_free 
	    where b_type != '공지사항' 
	    order by b_type = '공지사항' desc, groups desc, lev asc 
	    limit #{limit} offset #{offset}
	</select>
 	
 	<insert id="comm_board_insert" parameterType="cbvo">
 		<selectKey keyProperty="groups" resultType="String" order="BEFORE">
 			SELECT (IFNULL(MAX(b_idx),0)+1) as groups FROM board_free
 		</selectKey>
 		insert into board_free(member_idx, b_type, b_title, member_nickname, b_content, b_pwd, hit, groups, step, lev, regdate, f_name)
 			values(#{member_idx}, #{b_type}, #{b_title}, #{member_nickname}, #{b_content},#{b_pwd}, 0, #{groups}, 0, 0, sysdate(), #{f_name})
 	</insert>
 	
 	<update id="comm_board_hit" parameterType="String">
 		update board_free 
 		set hit = hit + 1 
 		where b_idx = #{b_idx} 
 	</update>
 	
 	<select id="comm_board_detail" parameterType="String" resultType="cbvo">
 		select * from board_free where b_idx = #{b_idx}
 	</select>
 	
 	<delete id="comm_board_delete" parameterType="cbvo">
 	 	delete from board_free where b_idx = #{b_idx}
 	</delete>
 	
 	<update id="comm_board_update" parameterType="cbvo">
 	 	update board_free 
 	 	set  b_title=#{b_title}, b_content=#{b_content}, f_name=#{f_name}
 	 	where b_idx = #{b_idx}  	 
 	 </update>
 	 
 	 <delete id="comm_board_admin_delete" parameterType="cbvo">
 	 	delete from board_free where b_idx = #{b_idx}
 	 </delete>
 	 
 	  <insert id="comm_reply_insert" parameterType="cbvo">
 	 	insert into board_free(member_idx, b_type, b_title, member_nickname, b_content, b_pwd, hit, groups, step, lev, regdate, f_name)
 			values(#{member_idx}, #{b_type}, #{b_title}, #{member_nickname}, #{b_content}, #{b_pwd}, 0, #{groups}, #{step}, #{lev}, sysdate(), #{f_name})
 	  </insert>
 	 
 	 <select id="comm_board_reply_detail" parameterType="cbvo" resultType="cbvo">
 		select * from board_free where b_idx = #{b_idx}
 	 </select>
 	
 	<!-- commet-rely -->
 	<select id="comment_list" parameterType="String" resultType="cvo">
 		select * from comment_t where b_idx = #{b_idx}
 	</select>
 	
 	<insert id="comment_insert" parameterType="cvo">
 		insert into comment_t(member_nickname, content, write_date, b_idx)
 			values(#{member_nickname}, #{content}, sysdate(), #{b_idx})
 	</insert>
 	
 	<delete id="comment_delete" parameterType="String">
 		delete from comment_t where c_idx = #{c_idx}
 	</delete>
 	
 	<update id="comment_update" parameterType="cvo">
 		update comment_t 
 		set content = #{content}, write_date = sysdate()
 	    where b_idx=#{b_idx} and c_idx = #{c_idx}
 	</update>
 	
 	<select id="comment_reply_list" parameterType="String" resultType="cvo">
 		select * from comment_t where b_idx = #{b_idx}
 	</select>
 	
 	<update id="lev_update" parameterType="cvo">
 	 	update comment_t set lev=lev+1 where groups=#{groups} and lev>=#{lev} 
 	 </update>
 	
 	<insert id="ans_insert" parameterType="cvo">
 	 	insert into comment_t(member_nickname, content, write_date, b_idx, step, lev)
 			values(#{member_nickname}, #{content}, sysdate(), #{b_idx}, #{step}, #{lev})
 	 </insert>
 	 
 	 <insert id="comment_reply_insert" parameterType="cvo">
 	 	insert into comment_t(member_nickname, content, write_date, b_idx, step, lev)
 			values(#{member_nickname}, #{content}, sysdate(), #{b_idx}, #{step}, #{lev})
 	 </insert>
 	 
 	 
 	 
 	<select id="board_free_list" resultType="bfvo">
 		select * from board_free where bf_no &gt;= 1 and bf_no &lt;= 100  order by bf_no
 	</select>
 	
 	<select id="board_free_search_list" parameterType="Map" resultType="bfvo">
 		select * from board_free where 
 		<choose>
 			<!-- <when test="searchType == 1"> Lower(b_title) = Lower(#{searchValue})</when> -->
 			
 			<when test="searchType == 1"> Lower(b_title) like concat('%', Lower(#{searchValue}),'%')</when>
 			<when test="searchType == 2"> Lower(b_content) like concat('%', Lower(#{searchValue}), '%')</when>
 			<when test="searchType == 3"> Lower(member_nickname) = Lower(#{searchValue})</when>
 			<when test="searchType == 4"> Lower(regdate) like concat( Lower(#{searchValue}), '%')</when>
 		</choose>
 		
 	</select>
 		
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
</mapper>