<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bjs">
	<select id="count" resultType="int">
		select count(*) from board_with
	</select>
	<select id="to_list" resultType="tvo">
		select b.*, m.member_nickname, m.member_dob, m.member_img
		from board_with b
		inner join members m on b.member_idx = m.member_idx
		where b.t_active = 0
		order by b.t_idx desc
		limit #{limit} offset #{offset}
	</select>
	<select id="camp_list" resultType="cvo">
		select * from camp_list
	</select>
	<select id="promiseCount" resultType="int">
		select count(*) from with_promise where t_idx = #{t_idx} and pm_state != -1
	</select>
	<select id="to_detail" parameterType="String" resultType="tvo">
		select b.*, m.member_nickname, m.member_dob, m.member_img
		from board_with b
		left join members m on b.member_idx = m.member_idx 
		where t_idx = #{t_idx}
	</select>
	<update id="to_hit" parameterType="String">
		update board_with set t_hit = t_hit + 1 where t_idx = #{t_idx}
	</update>
	<insert id="to_insert" parameterType="tvo">
		insert into board_with(member_idx, t_subject, t_content, t_campname, t_camptype, t_address, t_startdate, t_enddate, t_numpeople, t_regdate, tf_name, t_mapx, t_mapy, t_induty, t_facltdivnm, t_mangedivnm)
		values(#{member_idx}, #{t_subject}, #{t_content}, #{t_campname}, #{t_camptype}, #{t_address}, #{t_startdate}, #{t_enddate}, #{t_numpeople}, sysdate(), #{tf_name}, #{t_mapx}, #{t_mapy}, #{t_induty}, #{t_facltdivnm}, #{t_mangedivnm})
	</insert>
	<select id="write_t_idx" resultType="int">
		select LAST_INSERT_ID() AS t_idx
	</select>
	<insert id="promise_insert" parameterType="tvo">
		insert into with_promise(t_idx, member_idx, pm_state, pm_master, pm_regdate)
		values(#{t_idx}, #{member_idx}, 1, 1, sysdate())
	</insert>
	<select id="camp_chk" parameterType="String" resultType="int">
		select count(*) from camp_list where replace(facltnm, ' ', '') = #{campName}
	</select>
	<select id="camp_detail" parameterType="String" resultType="cvo">
		select * from camp_list where replace(facltnm, ' ', '') = #{campName}
	</select>
	<select id="to_list_search" parameterType="Map" resultType="tvo">
	   select b.*, m.member_nickname, m.member_dob, m.member_img
	    from board_with b
	    join members m on b.member_idx = m.member_idx
	    where 
	    <choose>
	        <when test="searchType == '제목'">
	            b.t_subject like concat('%', #{searchKeyword}, '%')
	        </when>
	        <when test="searchType == '내용'">
	            b.t_content like concat('%', #{searchKeyword}, '%')
	        </when>
	        <when test="searchType == '캠핑지'">
	            b.t_campname like concat('%', #{searchKeyword}, '%')
	        </when>
	    </choose>
	    and b.t_active != 1
	</select>
<!-- 	<select id="to_list_search" parameterType="Map" resultType="tvo"> -->
<!-- 	   select b.*, m.member_nickname, m.member_dob, m.member_img -->
<!-- 	    from board_with b -->
<!-- 	    join members m on b.member_idx = m.member_idx -->
<!-- 	    where  -->
<!-- 	    <choose> -->
<!-- 	        <when test="searchType == '제목'"> -->
<!-- 	            b.t_subject like concat('%', #{searchKeyword}, '%') -->
<!-- 	        </when> -->
<!-- 	        <when test="searchType == '내용'"> -->
<!-- 	            b.t_content like concat('%', #{searchKeyword}, '%') -->
<!-- 	        </when> -->
<!-- 	        <when test="searchType == '캠핑지'"> -->
<!-- 	            b.t_campname like concat('%', #{searchKeyword}, '%') -->
<!-- 	        </when> -->
<!-- 	    </choose> -->
<!-- 	    and b.t_active != 1 -->
<!-- 	    order by b.t_idx desc -->
<!-- 		limit #{limit} offset #{offset} -->
<!-- 	</select> -->
	<select id="promise_chk" parameterType="pvo" resultType="int">
		select count(*) from with_promise where t_idx = #{t_idx} and member_idx = #{member_idx}
	</select>
	<insert id="promise" parameterType="pvo">
		insert into with_promise(t_idx, member_idx, pm_regdate)
		values(#{t_idx}, #{member_idx}, sysdate())
	</insert>
	<delete id="promise_delete" parameterType="pvo">
		delete from with_promise where t_idx = #{t_idx} and member_idx = #{member_idx}
	</delete>
	<update id="to_update" parameterType="tvo">
		update board_with set t_subject = #{t_subject}, t_content = #{t_content}, t_campname = #{t_campname}, t_camptype = #{t_camptype}, t_address = #{t_address}, t_startdate = #{t_startdate}, t_enddate = #{t_enddate}, t_numpeople = #{t_numpeople}, tf_name = #{tf_name}, t_mapx = #{t_mapx}, t_mapy = #{t_mapy}, t_induty = #{t_induty}, t_facltdivnm = #{t_facltdivnm}, t_mangedivnm = #{t_mangedivnm} where t_idx = #{t_idx}
	</update>
	<update id="to_delete" parameterType="String">
		update board_with set t_active = 1 where t_idx = #{t_idx}
	</update>
</mapper>